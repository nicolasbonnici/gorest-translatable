#!/bin/bash
# Pre-commit hook: Run linting and tests before commit
#
# To install this hook, run:
#   cp .githooks/pre-commit .git/hooks/pre-commit
#   chmod +x .git/hooks/pre-commit
#
# Or use the install script:
#   ./.githooks/install.sh

set -e

echo "ğŸ” Running pre-commit checks..."
echo ""

# Run quality audit
echo "ğŸ”¬ Running quality audit..."
if ! make audit; then
    echo ""
    echo "âŒ Quality audit failed. Please fix the issues before committing."
    echo "   Run 'make audit' to see detailed quality check results."
    exit 1
fi

echo ""
echo "âœ… Quality audit passed"
echo ""

# Run linting
echo "ğŸ“ Running linter..."
if ! make lint; then
    echo ""
    echo "âŒ Linting failed. Please fix the issues before committing."
    echo "   You can run 'make lint-fix' to auto-fix some issues."
    exit 1
fi

echo ""
echo "âœ… Linting passed"
echo ""

# Run tests
echo "ğŸ§ª Running tests..."
if ! make test; then
    echo ""
    echo "âŒ Tests failed. Please fix the failing tests before committing."
    exit 1
fi

echo ""
echo "âœ… All tests passed"
echo ""
echo "âœ¨ Pre-commit checks completed successfully!"
